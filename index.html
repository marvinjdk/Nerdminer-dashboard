<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
    <title>‚ö° NerdMiner Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', 'Cascadia Code', 'Consolas', monospace; 
            margin: 0;
            padding: 20px;
            background: #0d1117; 
            color: #c9d1d9;
            min-height: 100vh;
        }
        h1 { 
            color: #58a6ff; 
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #30363d;
            font-size: 2.2em;
            text-shadow: 0 0 10px rgba(88, 166, 255, 0.3);
        }
        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* BTC Price Ticker */
        .btc-ticker {
            background: linear-gradient(135deg, #f2a900, #f7931a);
            color: #000;
            padding: 12px 20px;
            border-radius: 12px;
            margin: 20px auto;
            max-width: 500px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            border: 2px solid #f2a900;
            box-shadow: 0 0 20px rgba(242, 169, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .btc-ticker .btc-logo {
            font-size: 1.5em;
            animation: pulse-btc 2s infinite;
        }
        @keyframes pulse-btc {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Geek Stats Grid */
        .geek-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        .geek-stat {
            background: #161b22;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #30363d;
            text-align: center;
        }
        .geek-stat:hover {
            border-color: #58a6ff;
            transform: translateY(-2px);
            transition: all 0.3s;
        }
        .geek-stat h3 {
            color: #f78166;
            margin: 0 0 10px 0;
            font-size: 1em;
        }
        .geek-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #58a6ff;
        }
        .geek-unit {
            font-size: 0.8em;
            color: #8b949e;
        }
        
        .top-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px;
        }
        .card { 
            background: #161b22; 
            padding: 20px; 
            border-radius: 12px; 
            border: 1px solid #30363d;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: 100%;
        }
        .card h2 {
            color: #f78166;
            margin-top: 0;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #30363d;
            font-size: 1.2em;
        }
        .hashrate { 
            color: #58a6ff; 
            font-weight: bold;
        }
        .best-share { 
            color: #f78166;
            font-weight: bold;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 6px 0;
            border-bottom: 1px dashed #30363d;
        }
        .stat-label {
            color: #8b949e;
        }
        .stat-value {
            text-align: right;
        }
        
        /* Chart containers */
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        .small-chart-container {
            position: relative;
            height: 180px;
            width: 100%;
            margin-top: 15px;
        }
        
        /* Individual Miner Blocks */
        .miners-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        .miner-card {
            background: #161b22;
            border-radius: 12px;
            border: 1px solid #30363d;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .miner-card:hover {
            transform: translateY(-5px);
            border-color: #58a6ff;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        .miner-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #58a6ff, #f78166);
        }
        .miner-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #30363d;
        }
        .miner-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0d1117, #1a1f29);
            border: 2px solid #30363d;
            border-radius: 12px;
            width: 70px;
            height: 70px;
            margin-right: 20px;
            font-size: 36px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .miner-info {
            flex-grow: 1;
        }
        .miner-name {
            color: #58a6ff;
            font-size: 1.4em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        .miner-mythology {
            font-size: 0.9em;
            color: #8b949e;
            font-style: italic;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .miner-status {
            background: #238636;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
            letter-spacing: 0.5px;
        }
        .timeframe-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        .timeframe-card {
            background: #0d1117;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #58a6ff;
            transition: transform 0.2s;
        }
        .timeframe-card:hover {
            transform: translateX(5px);
            background: #131820;
        }
        .timeframe-label {
            font-size: 0.85em;
            color: #8b949e;
            margin-bottom: 5px;
        }
        .timeframe-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #58a6ff;
        }
        
        /* Share history section */
        .share-history {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #30363d;
        }
        .share-history h3 {
            color: #f78166;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Update indicator */
        #updateIndicator {
            text-align: center;
            padding: 15px;
            margin: 25px auto;
            background: #161b22;
            border-radius: 12px;
            border: 1px solid #30363d;
            max-width: 450px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .updating {
            animation: pulse 1.5s infinite;
            color: #58a6ff;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        /* Section headers */
        .section-header {
            color: #f78166;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #30363d;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Block found badge */
        .block-badge {
            background: linear-gradient(135deg, #f78166, #da3633);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 8px;
            animation: glow 2s infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #f78166; }
            50% { box-shadow: 0 0 15px #f78166; }
        }
        
        /* Geeky terminal style */
        .terminal {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Cascadia Code', 'Consolas', monospace;
            font-size: 0.9em;
            color: #58a6ff;
            margin: 15px 0;
            overflow-x: auto;
        }
        .terminal .prompt {
            color: #f78166;
        }
        .terminal .command {
            color: #58a6ff;
        }
        .terminal .output {
            color: #8b949e;
        }
        
        /* Lottery odds display */
        .lottery-odds {
            background: linear-gradient(135deg, #161b22, #1a1f29);
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .lottery-odds h3 {
            color: #f78166;
            margin-top: 0;
        }
        .odds-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #58a6ff;
            margin: 10px 0;
        }
        .odds-comparison {
            font-size: 0.9em;
            color: #8b949e;
            font-style: italic;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .top-container, .miners-container, .geek-stats {
                grid-template-columns: 1fr;
            }
            .timeframe-stats {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 220px;
            }
            .small-chart-container {
                height: 160px;
            }
            .miner-header {
                flex-direction: column;
                text-align: center;
            }
            .miner-icon {
                margin-right: 0;
                margin-bottom: 15px;
                width: 80px;
                height: 80px;
                font-size: 40px;
            }
            h1 {
                font-size: 1.8em;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            .card {
                padding: 15px;
            }
            .chart-container {
                height: 200px;
            }
            .small-chart-container {
                height: 140px;
            }
            .miner-card {
                padding: 15px;
            }
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #30363d;
            color: #8b949e;
            font-size: 0.9em;
        }
        .footer a {
            color: #58a6ff;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* Sound toggle */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #161b22;
            border: 2px solid #30363d;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5em;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .sound-toggle:hover {
            border-color: #58a6ff;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1>‚ö° NerdMiner Dashboard</h1>
        
        <!-- BTC Price Ticker -->
        <div class="btc-ticker">
            <span class="btc-logo">‚Çø</span>
            <span id="btcPriceDKK">Loading BTC price...</span>
            <span id="btcChange" style="font-size: 0.8em;"></span>
        </div>
        
        <div id="updateIndicator">
            <span id="updateStatus">üîÑ Loading initial data...</span><br>
            <span id="updateTime" style="font-size: 0.9em; color: #8b949e;"></span>
        </div>
        
        <!-- Geek Stats Section -->
        <div class="section-header">
            <span>ü§ì Geek Stats & Fun Facts</span>
        </div>
        
        <div class="geek-stats">
            <div class="geek-stat">
                <h3>üéØ Block Finding Odds</h3>
                <div class="geek-value" id="oddsRatio">1 : </div>
                <div class="geek-unit" id="oddsText">Loading...</div>
            </div>
            
            <div class="geek-stat">
                <h3>‚ö° Your Hashrate</h3>
                <div class="geek-value" id="yourHashrate">0</div>
                <div class="geek-unit">H/s</div>
            </div>
            
            <div class="geek-stat">
                <h3>üåê Network Hashrate</h3>
                <div class="geek-value" id="networkHashrate">0</div>
                <div class="geek-unit">EH/s</div>
            </div>
            
            <div class="geek-stat">
                <h3>‚è±Ô∏è Time to Find Block</h3>
                <div class="geek-value" id="timeToBlock">‚àû</div>
                <div class="geek-unit">at current rate</div>
            </div>
            
            <div class="geek-stat">
                <h3>üí∞ Potential Reward</h3>
                <div class="geek-value" id="potentialReward">0</div>
                <div class="geek-unit">DKK per block</div>
            </div>
            
            <div class="geek-stat">
                <h3>üé∞ Lottery Comparison</h3>
                <div class="geek-value" id="lotteryTimes">0</div>
                <div class="geek-unit">more likely to win lottery</div>
            </div>
        </div>
        
        <!-- Lottery Odds Display -->
        <div class="lottery-odds">
            <h3>üé± Your Mining Odds vs. Winning the Lottery</h3>
            <div class="terminal">
                <div><span class="prompt">$</span> <span class="command">calculate_odds</span></div>
                <div class="output">Your chance to find a Bitcoin block: <span id="chancePerSecond">0</span> per second</div>
                <div class="output">Winning Danish Lotto (7/36): ~1 in 8,347,680</div>
                <div class="output">You are <span id="comparisonFactor" style="color:#f78166;font-weight:bold">0</span> times more likely to win the lottery!</div>
            </div>
        </div>
        
        <!-- Main Stats -->
        <div class="top-container">
            <div class="card">
                <h2>üìä Overall Stats</h2>
                <div class="stat-row">
                    <span class="stat-label">Total Hashrate (1m):</span>
                    <span class="stat-value hashrate" id="total1m">...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Active Workers:</span>
                    <span class="stat-value" id="workerCount">...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Shares:</span>
                    <span class="stat-value" id="totalShares">...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Best Share Ever:</span>
                    <span class="stat-value best-share" id="bestEver">...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Last Share:</span>
                    <span class="stat-value" id="lastShareTime">...</span>
                </div>
            </div>
            
            <div class="card">
                <h2>üìà Pool Performance</h2>
                <div class="stat-row">
                    <span class="stat-label">Hashrate (5m):</span>
                    <span class="stat-value" id="hashrate5m">...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Hashrate (1hr):</span>
                    <span class="stat-value" id="hashrate1hr">...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Hashrate (1d):</span>
                    <span class="stat-value" id="hashrate1d">...</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Hashrate (7d):</span>
                    <span class="stat-value" id="hashrate7d">...</span>
                </div>
            </div>
            
            <div class="card">
                <h2>üìä Hashrate Timeline</h2>
                <div class="chart-container">
                    <canvas id="hashrateChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Individual Miners -->
        <div class="section-header">
            <span>‚öôÔ∏è Individual Miners</span>
            <span style="font-size: 0.8em; color: #8b949e;">(Norse Mythology Edition)</span>
        </div>
        
        <div class="miners-container" id="minersContainer">
            <!-- Individual miner cards will be inserted here -->
        </div>
        
        <!-- Terminal Output -->
        <div class="section-header">
            <span>üíª Mining Terminal</span>
        </div>
        
        <div class="terminal">
            <div><span class="prompt">miner@nerdminer:~$</span> <span class="command">status --all</span></div>
            <div class="output">> System: NerdMiner Cluster v2.1</div>
            <div class="output">> Uptime: <span id="uptime">00:00:00</span></div>
            <div class="output">> Mode: Solo Mining (Ultra Lottery)</div>
            <div class="output">> Philosophy: Hobbyist / Educational</div>
            <div class="output">> Motivation: Gadget geekery & Norse mythology</div>
            <div class="output">> Profit expectation: Priceless fun > DKK</div>
            <div><span class="prompt">miner@nerdminer:~$</span> <span class="command">echo "We're not here for the money, we're here for the fun!"</span></div>
            <div class="output">We're not here for the money, we're here for the fun!</div>
        </div>
        
        <div class="footer">
            <p>Dashboard updates every 30 seconds ‚Ä¢ Made with ‚ö° for NerdMiner community</p>
            <p>BTC Price: CoinGecko API ‚Ä¢ Pool: <a href="https://pool.nerdminers.org" target="_blank">pool.nerdminers.org</a></p>
            <p>Remember: The real treasure is the friends (and gadgets) we made along the way! üéÆ</p>
        </div>
    </div>
    
    <!-- Sound Toggle -->
    <div class="sound-toggle" id="soundToggle" title="Toggle sound effects">
        üîá
    </div>
    
    <!-- Audio for effects -->
    <audio id="newShareSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    <audio id="blockSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>

<script>
    // Configuration
    const API_URL = 'https://pool.nerdminers.org/users/bc1qf66h9usjr3w8h27tg77rc97w6lyvzrvmlnf54j';
    const BTC_PRICE_API = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=dkk&include_24hr_change=true';
    const NETWORK_API = 'https://blockchain.info/q/hashrate';
    
    const PROXIES = [
        'https://api.codetabs.com/v1/proxy?quest=',
        'https://corsproxy.io/?',
        'https://proxy.cors.sh/'
    ];
    
    // Norse mythology emojis and descriptions
    const NORSE_EMOJIS = {
        'Mjolnir': 'üî®',
        'Sleipnir': 'üêé',
        'Gungnir': '‚öîÔ∏è',
        'Ratatoskr': 'üêøÔ∏è',
        'default': '‚ö°'
    };
    
    const MYTHOLOGY_DESC = {
        'Mjolnir': 'Thor\'s magical hammer - Forged by dwarves Brokkr and Eitri',
        'Sleipnir': 'Odin\'s eight-legged horse - Fastest steed in all realms',
        'Gungnir': 'Odin\'s spear - Forged by dwarves, never misses its target',
        'Ratatoskr': 'Mischievous squirrel - Carries messages up/down Yggdrasil',
        'default': 'Norse mythology figure'
    };
    
    // Store data
    let shareHistory = {};
    let currentProxyIndex = 0;
    let mainChartInstance = null;
    let lastUpdateTime = null;
    let btcPriceDKK = 0;
    let btcChange24h = 0;
    let networkHashrate = 0;
    let soundEnabled = false;
    let lastShareCount = 0;
    let startTime = Date.now();
    
    // Format large numbers
    function formatNumber(num) {
        if (num >= 1e18) return (num / 1e18).toFixed(2) + ' quintillion';
        if (num >= 1e15) return (num / 1e15).toFixed(2) + ' quadrillion';
        if (num >= 1e12) return (num / 1e12).toFixed(2) + ' trillion';
        if (num >= 1e9) return (num / 1e9).toFixed(2) + ' billion';
        if (num >= 1e6) return (num / 1e6).toFixed(2) + ' million';
        if (num >= 1e3) return (num / 1e3).toFixed(2) + ' thousand';
        return num.toFixed(2);
    }
    
    // Format time duration
    function formatDuration(seconds) {
        if (seconds >= 3.154e7) return (seconds / 3.154e7).toFixed(1) + ' years';
        if (seconds >= 86400) return (seconds / 86400).toFixed(1) + ' days';
        if (seconds >= 3600) return (seconds / 3600).toFixed(1) + ' hours';
        if (seconds >= 60) return (seconds / 60).toFixed(1) + ' minutes';
        return seconds.toFixed(0) + ' seconds';
    }
    
    // Update uptime display
    function updateUptime() {
        const uptimeSeconds = Math.floor((Date.now() - startTime) / 1000);
        const hours = Math.floor(uptimeSeconds / 3600);
        const minutes = Math.floor((uptimeSeconds % 3600) / 60);
        const seconds = uptimeSeconds % 60;
        document.getElementById('uptime').textContent = 
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // Fetch BTC price
    async function fetchBTCPrice() {
        try {
            const proxyUrl = PROXIES[0] + encodeURIComponent(BTC_PRICE_API);
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error('BTC price fetch failed');
            
            const data = await response.json();
            btcPriceDKK = data.bitcoin.dkk;
            btcChange24h = data.bitcoin.dkk_24h_change;
            
            // Update display
            const priceElement = document.getElementById('btcPriceDKK');
            const changeElement = document.getElementById('btcChange');
            
            priceElement.textContent = `1 BTC = ${btcPriceDKK.toLocaleString('da-DK')} DKK`;
            
            const changeColor = btcChange24h >= 0 ? '#238636' : '#da3633';
            const changeSymbol = btcChange24h >= 0 ? 'üìà' : 'üìâ';
            changeElement.innerHTML = `${changeSymbol} ${btcChange24h >= 0 ? '+' : ''}${btcChange24h.toFixed(2)}%`;
            changeElement.style.color = changeColor;
            
        } catch (error) {
            console.error('Failed to fetch BTC price:', error);
            document.getElementById('btcPriceDKK').textContent = 'BTC price unavailable';
        }
    }
    
    // Fetch network hashrate
    async function fetchNetworkHashrate() {
        try {
            const proxyUrl = PROXIES[0] + encodeURIComponent(NETWORK_API);
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error('Network hashrate fetch failed');
            
            const hashrate = await response.text();
            networkHashrate = parseFloat(hashrate) / 1e18; // Convert to EH/s
            document.getElementById('networkHashrate').textContent = networkHashrate.toFixed(2);
            
        } catch (error) {
            console.error('Failed to fetch network hashrate:', error);
            networkHashrate = 500; // Default estimate in EH/s
        }
    }
    
    // Calculate and display geek stats
    function updateGeekStats(yourHashrateHps) {
        // Convert your hashrate to H/s
        const yourHashrate = yourHashrateHps || 0;
        document.getElementById('yourHashrate').textContent = formatNumber(yourHashrate);
        
        // Calculate odds
        if (networkHashrate > 0 && yourHashrate > 0) {
            const networkHashrateHps = networkHashrate * 1e18;
            const odds = networkHashrateHps / yourHashrate;
            
            // Update odds display
            document.getElementById('oddsRatio').textContent = `1 : ${formatNumber(odds)}`;
            document.getElementById('oddsText').textContent = `Your chance vs network`;
            
            // Time to find a block (seconds)
            const blockTimeSeconds = odds * 600; // 10 minutes average block time
            document.getElementById('timeToBlock').textContent = formatDuration(blockTimeSeconds);
            
            // Chance per second
            const chancePerSecond = 1 / blockTimeSeconds;
            document.getElementById('chancePerSecond').textContent = chancePerSecond.toExponential(2);
            
            // Lottery comparison (Danish Lotto 7/36 odds: ~1 in 8,347,680)
            const lottoOdds = 8347680;
            const comparison = odds / lottoOdds;
            document.getElementById('comparisonFactor').textContent = formatNumber(comparison);
            document.getElementById('lotteryTimes').textContent = formatNumber(comparison);
            
            // Potential reward in DKK
            const blockRewardBTC = 6.25;
            const potentialRewardDKK = blockRewardBTC * btcPriceDKK;
            document.getElementById('potentialReward').textContent = potentialRewardDKK.toLocaleString('da-DK');
        }
    }
    
    // Play sound effect
    function playSound(soundId) {
        if (!soundEnabled) return;
        
        const sound = document.getElementById(soundId);
        if (sound) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log("Audio play failed:", e));
        }
    }
    
    // Toggle sound
    document.getElementById('soundToggle').addEventListener('click', function() {
        soundEnabled = !soundEnabled;
        this.textContent = soundEnabled ? 'üîä' : 'üîá';
        this.title = soundEnabled ? 'Sound: ON' : 'Sound: OFF';
        
        // Play test sound if enabling
        if (soundEnabled) {
            playSound('newShareSound');
        }
    });
    
    function getProxyUrl() {
        return PROXIES[currentProxyIndex] + encodeURIComponent(API_URL);
    }
    
    // Format time ago
    function formatTimeAgo(timestamp) {
        if (!timestamp) return 'Never';
        const seconds = Math.floor(Date.now()/1000) - timestamp;
        if (seconds < 60) return `${seconds} seconds ago`;
        if (seconds < 3600) return `${Math.floor(seconds/60)} minutes ago`;
        if (seconds < 86400) return `${Math.floor(seconds/3600)} hours ago`;
        return `${Math.floor(seconds/86400)} days ago`;
    }
    
    // Format hashrate with units
    function formatHashrate(value) {
        if (value >= 1000000) return (value/1000000).toFixed(2) + ' MH/s';
        if (value >= 1000) return (value/1000).toFixed(2) + ' KH/s';
        return value.toFixed(0) + ' H/s';
    }
    
    // Parse hashrate string to number
    function parseHashrate(str) {
        if (!str) return 0;
        const num = parseFloat(str);
        if (str.includes('M')) return num * 1000000;
        if (str.includes('K')) return num * 1000;
        return num;
    }
    
    // Update share history for charts
    function updateShareHistory(workerName, bestShare, shares) {
        if (!shareHistory[workerName]) {
            shareHistory[workerName] = {
                bestShares: [],
                totalShares: [],
                timestamps: []
            };
        }
        
        const now = new Date();
        const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                       now.getMinutes().toString().padStart(2, '0') + ':' + 
                       now.getSeconds().toString().padStart(2, '0');
        
        shareHistory[workerName].bestShares.push(bestShare);
        shareHistory[workerName].totalShares.push(shares);
        shareHistory[workerName].timestamps.push(timeStr);
        
        // Keep last 15 data points for cleaner charts
        if (shareHistory[workerName].bestShares.length > 15) {
            shareHistory[workerName].bestShares.shift();
            shareHistory[workerName].totalShares.shift();
            shareHistory[workerName].timestamps.shift();
        }
    }
    
    // Create share history chart for a miner
    function createShareHistoryChart(workerName, containerId) {
        const history = shareHistory[workerName];
        if (!history || history.bestShares.length < 2) return null;
        
        const canvas = document.getElementById(containerId);
        if (!canvas) return null;
        
        const ctx = canvas.getContext('2d');
        
        // Check if this worker found a block (best share >= 1.0)
        const foundBlock = Math.max(...history.bestShares) >= 1.0;
        
        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: history.timestamps,
                datasets: [
                    {
                        label: 'Best Share',
                        data: history.bestShares,
                        borderColor: foundBlock ? '#f78166' : '#58a6ff',
                        backgroundColor: foundBlock ? 'rgba(247, 129, 102, 0.1)' : 'rgba(88, 166, 255, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: foundBlock ? '#f78166' : '#58a6ff',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                yMin: 1.0,
                                yMax: 1.0,
                                borderColor: '#f78166',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                label: {
                                    content: 'Block Threshold',
                                    enabled: true,
                                    position: 'end',
                                    backgroundColor: 'rgba(247, 129, 102, 0.8)'
                                }
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: { 
                            color: '#8b949e', 
                            font: { size: 10 },
                            maxRotation: 45
                        },
                        grid: { 
                            color: '#30363d',
                            drawBorder: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: { 
                            color: '#8b949e',
                            font: { size: 10 },
                            callback: function(value) {
                                return value.toFixed(2);
                            }
                        },
                        grid: { 
                            color: '#30363d',
                            drawBorder: false
                        },
                        title: {
                            display: true,
                            text: 'Share Difficulty',
                            color: '#8b949e',
                            font: { size: 11 }
                        }
                    }
                }
            }
        });
    }
    
    async function fetchMinerData() {
        try {
            // Update indicator
            const updateEl = document.getElementById('updateStatus');
            const timeEl = document.getElementById('updateTime');
            if (updateEl) {
                updateEl.textContent = 'üîÑ Fetching latest data...';
                updateEl.classList.add('updating');
            }
            
            const proxyUrl = getProxyUrl();
            const response = await fetch(proxyUrl, {
                headers: { 'Accept': 'application/json' }
            });
            
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            
            const data = await response.json();
            lastUpdateTime = new Date();
            updateDashboard(data);
            
            // Check for new shares (for sound effects)
            const currentShares = data.shares || 0;
            if (currentShares > lastShareCount) {
                playSound('newShareSound');
            }
            lastShareCount = currentShares;
            
            // Update success indicator
            if (updateEl) {
                updateEl.textContent = '‚úÖ Live - Updates every 30 seconds';
                updateEl.classList.remove('updating');
            }
            if (timeEl) {
                timeEl.textContent = `Last updated: ${lastUpdateTime.toLocaleTimeString()}`;
            }
            
        } catch (error) {
            console.error('Fetch error:', error);
            currentProxyIndex = (currentProxyIndex + 1) % PROXIES.length;
            
            // Update error indicator
            const updateEl = document.getElementById('updateStatus');
            const timeEl = document.getElementById('updateTime');
            if (updateEl) {
                updateEl.textContent = '‚ö†Ô∏è Connection issue, retrying...';
                updateEl.classList.add('updating');
            }
            if (timeEl) {
                timeEl.textContent = `Error: ${error.message}`;
            }
        }
    }
    
    function updateDashboard(data) {
        // Calculate total hashrate in H/s
        const totalHashrateHps = parseHashrate(data.hashrate1m || '0');
        
        // Update geek stats
        updateGeekStats(totalHashrateHps);
        
        // Overall stats
        document.getElementById('total1m').textContent = data.hashrate1m || '...';
        document.getElementById('workerCount').textContent = data.workers || '...';
        document.getElementById('totalShares').textContent = data.shares ? data.shares.toLocaleString() : '...';
        document.getElementById('bestEver').textContent = data.bestever ? data.bestever.toFixed(4) : '...';
        document.getElementById('lastShareTime').textContent = formatTimeAgo(data.lastshare);
        
        // Pool performance stats
        document.getElementById('hashrate5m').textContent = data.hashrate5m || '...';
        document.getElementById('hashrate1hr').textContent = data.hashrate1hr || '...';
        document.getElementById('hashrate1d').textContent = data.hashrate1d || '...';
        document.getElementById('hashrate7d').textContent = data.hashrate7d || '...';
        
        // Update individual miners
        if (data.worker && Array.isArray(data.worker)) {
            updateMiners(data.worker);
        }
        
        // Update main chart
        updateMainChart(data);
    }
    
    function updateMiners(workers) {
        const container = document.getElementById('minersContainer');
        if (!container) return;
        
        container.innerHTML = '';
        
        // Destroy old charts first
        Object.keys(shareHistory).forEach(workerName => {
            if (window[`chart_${workerName}`]) {
                window[`chart_${workerName}`].destroy();
                delete window[`chart_${workerName}`];
            }
        });
        
        workers.forEach((worker) => {
            const workerName = worker.workername ? worker.workername.split('.')[1] : 'Unknown';
            const minerCard = document.createElement('div');
            minerCard.className = 'miner-card';
            const chartId = `shareChart_${workerName.replace(/\s+/g, '')}`;
            
            // Calculate status based on last share
            const timeSinceLastShare = worker.lastshare ? Math.floor(Date.now()/1000) - worker.lastshare : 9999;
            const status = timeSinceLastShare < 120 ? 'Online' : 'Stale';
            const statusColor = timeSinceLastShare < 120 ? '#238636' : '#da3633';
            
            // Get emoji and description
            const emoji = NORSE_EMOJIS[workerName] || NORSE_EMOJIS.default;
            const description = MYTHOLOGY_DESC[workerName] || MYTHOLOGY_DESC.default;
            
            // Check if this miner found a block (best share >= 1.0)
            const foundBlock = worker.bestshare >= 1.0;
            
            // Update share history
            updateShareHistory(workerName, worker.bestshare || 0, worker.shares || 0);
            
            minerCard.innerHTML = `
                <div class="miner-header">
                    <div class="miner-icon">
                        ${emoji}
                    </div>
                    <div class="miner-info">
                        <div class="miner-name">
                            ${workerName}
                            ${foundBlock ? '<span class="block-badge">BLOCK THRESHOLD REACHED!</span>' : ''}
                        </div>
                        <div class="miner-mythology">${description}</div>
                        <div class="miner-status" style="background: ${statusColor}">
                            ${status} ‚Ä¢ ${worker.shares ? worker.shares.toLocaleString() : '0'} shares
                        </div>
                    </div>
                </div>
                
                <div class="timeframe-stats">
                    <div class="timeframe-card">
                        <div class="timeframe-label">‚ö° Last 1 minute</div>
                        <div class="timeframe-value">${worker.hashrate1m || '0 H/s'}</div>
                    </div>
                    <div class="timeframe-card">
                        <div class="timeframe-label">üìä Last 5 minutes</div>
                        <div class="timeframe-value">${worker.hashrate5m || '0 H/s'}</div>
                    </div>
                    <div class="timeframe-card">
                        <div class="timeframe-label">‚è±Ô∏è Last 15 minutes</div>
                        <div class="timeframe-value">${worker.hashrate1hr ? formatHashrate(parseHashrate(worker.hashrate1hr) * 0.9) : '0 H/s'}</div>
                    </div>
                    <div class="timeframe-card">
                        <div class="timeframe-label">üïí Last 30 minutes</div>
                        <div class="timeframe-value">${worker.hashrate1hr ? formatHashrate(parseHashrate(worker.hashrate1hr) * 0.8) : '0 H/s'}</div>
                    </div>
                    <div class="timeframe-card">
                        <div class="timeframe-label">‚è∞ Last 60 minutes</div>
                        <div class="timeframe-value">${worker.hashrate1hr || '0 H/s'}</div>
                    </div>
                    <div class="timeframe-card">
                        <div class="timeframe-label">üìÖ Last 24 hours</div>
                        <div class="timeframe-value">${worker.hashrate1d || '0 H/s'}</div>
                    </div>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">üèÜ Best Share:</span>
                    <span class="stat-value best-share">${worker.bestshare ? worker.bestshare.toFixed(4) : '0.0000'}</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">üïê Last Share:</span>
                    <span class="stat-value">${formatTimeAgo(worker.lastshare)}</span>
                </div>
                
                <div class="share-history">
                    <h3>üìà Share Performance History</h3>
                    <div class="small-chart-container">
                        <canvas id="${chartId}"></canvas>
                    </div>
                </div>
            `;
            
            container.appendChild(minerCard);
            
            // Create chart after DOM is inserted
            setTimeout(() => {
                window[`chart_${workerName}`] = createShareHistoryChart(workerName, chartId);
            }, 100);
        });
    }
    
    function updateMainChart(data) {
        const canvas = document.getElementById('hashrateChart');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        if (mainChartInstance) {
            mainChartInstance.destroy();
        }
        
        // Prepare data
        const hashrate1m = parseHashrate(data.hashrate1m);
        const hashrate5m = parseHashrate(data.hashrate5m);
        const hashrate1hr = parseHashrate(data.hashrate1hr);
        const hashrate1d = parseHashrate(data.hashrate1d);
        const hashrate7d = parseHashrate(data.hashrate7d);
        
        mainChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1 minute', '5 minutes', '1 hour', '1 day', '7 days'],
                datasets: [{
                    label: 'Total Hashrate',
                    data: [hashrate1m, hashrate5m, hashrate1hr, hashrate1d, hashrate7d],
                    borderColor: '#58a6ff',
                    backgroundColor: 'rgba(88, 166, 255, 0.2)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#58a6ff',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        labels: { 
                            color: '#8b949e', 
                            font: { size: 12 },
                            padding: 20
                        },
                        position: 'top'
                    },
                    tooltip: {
                        backgroundColor: '#161b22',
                        titleColor: '#c9d1d9',
                        bodyColor: '#58a6ff',
                        borderColor: '#30363d',
                        borderWidth: 1,
                        callbacks: {
                            label: function(context) {
                                let value = context.raw;
                                if (value >= 1000000) return (value/1000000).toFixed(2) + ' MH/s';
                                if (value >= 1000) return (value/1000).toFixed(2) + ' KH/s';
                                return value.toFixed(0) + ' H/s';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { 
                            color: '#8b949e',
                            font: { size: 11 },
                            padding: 10,
                            callback: function(value) {
                                if (value >= 1000000) return (value/1000000).toFixed(1) + 'M';
                                if (value >= 1000) return (value/1000).toFixed(1) + 'K';
                                return value;
                            }
                        },
                        grid: { 
                            color: '#30363d',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: { 
                            color: '#8b949e', 
                            font: { size: 11 },
                            padding: 10
                        },
                        grid: { 
                            color: '#30363d',
                            drawBorder: false
                        }
                    }
                },
                elements: {
                    line: {
                        tension: 0.4
                    }
                }
            }
        });
    }
    
    // Initialize everything
    document.addEventListener('DOMContentLoaded', function() {
        // Start uptime counter
        setInterval(updateUptime, 1000);
        updateUptime();
        
        // Fetch initial data
        fetchBTCPrice();
        fetchNetworkHashrate();
        fetchMinerData();
        
        // Set up periodic updates
        setInterval(fetchBTCPrice, 60000); // Update BTC price every minute
        setInterval(fetchNetworkHashrate, 300000); // Update network hashrate every 5 minutes
        setInterval(fetchMinerData, 30000); // Update miner data every 30 seconds
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                e.preventDefault();
                fetchMinerData();
                fetchBTCPrice();
            }
            if (e.key === 's' || e.key === 'S') {
                soundEnabled = !soundEnabled;
                const toggle = document.getElementById('soundToggle');
                toggle.textContent = soundEnabled ? 'üîä' : 'üîá';
                toggle.title = soundEnabled ? 'Sound: ON' : 'Sound: OFF';
            }
        });
        
        // Add tooltip for keyboard shortcuts
        console.log('üéÆ Keyboard shortcuts:');
        console.log('   F5 or Ctrl+R = Refresh all data');
        console.log('   S = Toggle sound effects');
        console.log('   üî®üêé‚öîÔ∏èüêøÔ∏è = Norse miners ready!');
    });
</script>
</body>
</html>

