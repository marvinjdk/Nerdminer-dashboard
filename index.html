<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NerdMiner Norse Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-gray-200 min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-2">⚡ Norse NerdMiner Dashboard</h1>
    <p class="text-gray-400 mb-6">Live-status view for your ESP32 NerdMiner fleet via Nerdminers.org pool API.</p>

    <div id="miners" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4"></div>

    <div class="mt-8 p-4 bg-gray-900 rounded-xl text-sm text-gray-400">
      <h2 class="text-lg font-semibold mb-2 text-gray-200">ℹ️ How this works</h2>
      <ul class="list-disc pl-5 space-y-1">
        <li>This dashboard fetches JSON directly from your Nerdminers.org user page.</li>
        <li>It automatically displays your miners’ 1m hashrate, shares, best share, and last share.</li>
        <li>Refreshes every 15 seconds.</li>
      </ul>
    </div>
  </div>

<script>
const poolUserJSON = "https://pool.nerdminers.org/users/3HQ1sYR1wNSGr6BLJsxVz1bV5SFTANLwBT";
const container = document.getElementById("miners");

function renderMiner(worker) {
  const name = worker.workername.split('.')[1] || worker.workername;
  return `
    <div class="bg-gray-900 rounded-2xl shadow-lg p-4">
      <h3 class="text-xl font-bold mb-1">${name}</h3>
      <p class="text-sm text-gray-400">1m Hashrate: ${worker.hashrate1m} kH/s</p>
      <p class="text-sm text-gray-400">5m Hashrate: ${worker.hashrate5m} kH/s</p>
      <p class="text-sm text-gray-400">1h Hashrate: ${worker.hashrate1hr} kH/s</p>
      <p class="text-sm text-gray-400">Shares: ${worker.shares}</p>
      <p class="text-sm text-gray-400">Best Share: ${worker.bestshare}</p>
      <p class="text-sm text-gray-400">Best Ever: ${worker.bestever}</p>
    </div>
  `;
}

async function loadDashboard() {
  try {
    const res = await fetch(poolUserJSON);
    const data = await res.json();
    container.innerHTML = '';
    if (data.workers) {
      data.workers.forEach(worker => {
        container.innerHTML += renderMiner(worker);
      });
    } else {
      container.innerHTML = '<p class="text-red-400">No miners found in JSON.</p>';
    }
  } catch (e) {
    container.innerHTML = '<p class="text-red-400">Failed to fetch pool JSON.</p>';
  }
}

loadDashboard();
setInterval(loadDashboard, 15000);
</script>
</body>
</html>
